{
  "hash": "00f86e56a56aada800692ed5da68e6d3",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Visualizing 445 Calendar in R\"\ndate: \"2024-12-29\"\ncategories: [r, ggplot, calendar]\nformat:\n  html:\n    code-fold: true\nexecute:\n  echo: true\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n\n\n### Have You Heard of the 4-4-5 Calendar? 📆\n\nIf you’ve worked in retail, you might already know that time isn’t always measured in standard months. Enter the 4-4-5 calendar: a reporting tool that divides a year into 12 periods, each organized into quarters of 4, 4, and 5 weeks (i.e. 13 weeks in each quarter). This structure ensures comparability across years by standardizing the length of each reporting period. (But yes, this isn’t perfect either—every 5-6 years, this produces a year with 53 weeks.)\n\n### Why Use a 4-4-5 Calendar?\n\nStandard Gregorian calendars often lead to reporting headaches🤕, especially when months have varying lengths or different counts of weekends. The 4-4-5 calendar solves this by:\n\n-   Aligning periods to weeks, making year-over-year comparisons simpler.\n-   Standardizing reporting cycles, especially for weekly-driven industries like retail.\n-   Providing flexibility with alternative formats, such as the 4-5-4 calendar, for specific business needs.\n\nThere's also a sibling version👧🏻, the 4-5-4 calendar, which I personally prefer because it ensures that American Thanksgiving 🦃🎁 always falls within Period 11. In contrast, the 4-4-5 calendar may place Thanksgiving in Period 11 or 12, depending on the year.\n\n### Building a Custom 4-4-5 Calendar in R\n\nTo create a reusable tool, I developed the create_calendar function. This function takes a year and a calendar type (\"445\" or \"454\") and returns a detailed tibble with dates, weeks, periods, and quarters. Function takes the year, and returns calendar as data frame.\n\n``` R\ncreate_calendar <- function(year, calendar_type = \"445\", col_pal = NULL, ...) {\n  if (is.null(col_pal)) {\n    col_pal <- ggthemes::tableau_color_pal(\"Hue Circle\")(19)[c(1:13)]\n  }\n  \n  cal <- tibble(\n    dt = seq.Date(ymd(paste0(year-1, \"-12-01\")), ymd(paste0(year, \"-12-31\")), by = \"day\")\n  )\n  \n  wpq <- switch(calendar_type,\n                \"445\" = tibble(\n                  wk = 1:53,\n                  p = sort(c(rep(1:12, each = 4), c(3, 6, 9, 12, 12))),\n                  q = sort(c(rep(1:4, each = 13), c(4)))\n                ),\n                \"454\" = tibble(\n                  wk = 1:53,\n                  p = sort(c(rep(1:12, each=4), c(2, 5, 8, 11, 12))),\n                  q = sort(c(rep(1:4, each = 13), c(4)))\n                ),\n                stop(\"Invalid calendar type. Choose '445' or '454'.\")\n  )\n  \n  cal <- cal |>\n    mutate(\n      yr = isoyear(dt),\n      wk = isoweek(dt),\n      wday = wday(dt, label = TRUE)\n    ) |>\n    left_join(wpq, by = \"wk\") |>\n    mutate(color_num=wk + p + q) |>\n    mutate(color_wk = colourvalues::color_values(color_num, \n                                                 palette=farver::decode_colour(col_pal))) |>\n    filter(yr==year)\n  \n  return(cal)\n}\n```\n\n### Making the Visual Calendar\n\n::: panel-tabset\n#### 2025 - 445 🗓️\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#create_calendar(year=2025, calendar_type=\"445\")\n\ncreate_calendar(year=2025, calendar_type=\"445\") |>\n  ggplot(aes(x=wday,y=color_num)) +\n  geom_tile(aes(fill=I(color_wk)), color=\"#ffffffde\") +\n  geom_text(aes(label=day(dt),color=I(if_else(month(dt)==p,\"#ffffff\",\"#e3e3e3\"))),  family=\"Roboto Condensed\") +\n  geom_text(aes(label=str_c(\"W\",wk),color=I(color_wk),x=0),\n            family=\"Roboto Condensed\", \n            data = . %>% count(wk,color_num,color_wk,p,q))+\n  geom_blank(aes(x=-1)) +\n  scale_y_reverse(breaks=NULL) +\n  scale_x_discrete(labels=~str_sub(.,1L,2L)) +\n  facet_wrap(~p,ncol=3, scales=\"free\") +\n  cowplot::theme_minimal_grid(font_family=\"Roboto Condensed\",line_size=0) +\n  labs(x=\"\",y=\"\") \n```\n\n::: {.cell-output-display}\n![](calendar_generator_files/figure-html/unnamed-chunk-2-1.png){width=768}\n:::\n:::\n\n\n\n#### 2025 - 454 🗓️\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncreate_calendar(year=2025, calendar_type=\"454\") |>\n  ggplot(aes(x=wday,y=color_num)) +\n  geom_tile(aes(fill=I(color_wk)), color=\"#ffffffde\") +\n  geom_text(aes(label=day(dt),color=I(if_else(month(dt)==p,\"#ffffff\",\"#e3e3e3\"))),  family=\"Roboto Condensed\") +\n  geom_text(aes(label=str_c(\"W\",wk),color=I(color_wk),x=0),\n            family=\"Roboto Condensed\", \n            data = . %>% count(wk,color_num,color_wk,p,q))+\n  geom_blank(aes(x=-1)) +\n  scale_y_reverse(breaks=NULL) +\n  scale_x_discrete(labels=~str_sub(.,1L,2L)) +\n  facet_wrap(~p,ncol=3, scales=\"free\") +\n  cowplot::theme_minimal_grid(font_family=\"Roboto Condensed\",line_size=0) +\n  labs(x=\"\",y=\"\")\n```\n\n::: {.cell-output-display}\n![](calendar_generator_files/figure-html/unnamed-chunk-3-1.png){width=768}\n:::\n:::\n\n\n\n#### 2024 - 445 🗓️\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncreate_calendar(year=2024, calendar_type=\"445\") |>\n  ggplot(aes(x=wday,y=color_num)) +\n  geom_tile(aes(fill=I(color_wk)), color=\"#ffffffde\") +\n  geom_text(aes(label=day(dt),color=I(if_else(month(dt)==p,\"#ffffff\",\"#e3e3e3\"))),  family=\"Roboto Condensed\") +\n  geom_text(aes(label=str_c(\"W\",wk),color=I(color_wk),x=0),\n            family=\"Roboto Condensed\", \n            data = . %>% count(wk,color_num,color_wk,p,q))+\n  geom_blank(aes(x=-1)) +\n  scale_y_reverse(breaks=NULL) +\n  scale_x_discrete(labels=~str_sub(.,1L,2L)) +\n  facet_wrap(~p,ncol=3, scales=\"free\") +\n  cowplot::theme_minimal_grid(font_family=\"Roboto Condensed\",line_size=0) +\n  labs(x=\"\",y=\"\")\n```\n\n::: {.cell-output-display}\n![](calendar_generator_files/figure-html/unnamed-chunk-4-1.png){width=768}\n:::\n:::\n\n\n\n#### 2024 - 445 🗓️\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncreate_calendar(year=2024, calendar_type=\"454\") |>\n  ggplot(aes(x=wday,y=color_num)) +\n  geom_tile(aes(fill=I(color_wk)), color=\"#ffffffde\") +\n  geom_text(aes(label=day(dt),color=I(if_else(month(dt)==p,\"#ffffff\",\"#e3e3e3\"))),  family=\"Roboto Condensed\") +\n  geom_text(aes(label=str_c(\"W\",wk),color=I(color_wk),x=0),\n            family=\"Roboto Condensed\", \n            data = . %>% count(wk,color_num,color_wk,p,q))+\n  geom_blank(aes(x=-1)) +\n  scale_y_reverse(breaks=NULL) +\n  scale_x_discrete(labels=~str_sub(.,1L,2L)) +\n  facet_wrap(~p,ncol=3, scales=\"free\") +\n  cowplot::theme_minimal_grid(font_family=\"Roboto Condensed\",line_size=0) +\n  labs(x=\"\",y=\"\")\n```\n\n::: {.cell-output-display}\n![](calendar_generator_files/figure-html/unnamed-chunk-5-1.png){width=768}\n:::\n:::\n\n\n:::\n",
    "supporting": [
      "calendar_generator_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}